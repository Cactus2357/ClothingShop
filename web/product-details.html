<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <script src="asset/script/color-modes.js"></script>

    <link rel="stylesheet" href="asset/style/theme-button.css" />
    <link rel="stylesheet" href="asset/style/image-placeholder.css" />

    <link href="https://cdn.jsdelivr.net/npm/summernote@0.9.1/dist/summernote-bs5.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.9.1/dist/summernote-bs5.min.js"></script>

    <style>
      body {
        min-height: 75rem;
        padding-top: 4.5rem;
      }

      .product-item:hover {
        --bs-border-opacity: 1;
        border-color: rgba(var(--bs-primary-rgb), var(--bs-border-opacity)) !important;
        box-shadow: var(--bs-box-shadow) !important;
      }

      .ratings {
        display: flex !important;
        gap: 0.25rem !important;
        align-items: center !important;
      }

      .attachment-input::-webkit-file-upload-button {
        display: none;
      }

      .attachment-btn {
        /* border-radius: var(--bs-border-radius-pill) !important;
        padding-right: 1rem !important;
        padding-left: 1rem !important; */
        background-color: var(--bs-success-bg-subtle) !important;
        --bs-text-opacity: 1;
        color: rgba(var(--bs-success-rgb), var(--bs-text-opacity)) !important;
        --bs-border-opacity: 1;
        border-color: rgba(var(--bs-success-rgb), var(--bs-border-opacity)) !important;
      }
    </style>
  </head>
  <body>
    <div>
      <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
        <symbol id="check2" viewBox="0 0 16 16">
          <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" />
        </symbol>
        <symbol id="circle-half" viewBox="0 0 16 16">
          <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z" />
        </symbol>
        <symbol id="moon-stars-fill" viewBox="0 0 16 16">
          <path
            d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"
          />
          <path
            d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"
          />
        </symbol>
        <symbol id="sun-fill" viewBox="0 0 16 16">
          <path
            d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"
          />
        </symbol>
      </svg>
      <div class="dropdown position-fixed bottom-0 end-0 mb-3 me-3 bd-mode-toggle">
        <button class="btn btn-bd-primary py-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" data-bs-toggle="dropdown" data-bs-auto-close="outside">
          <svg class="bi my-1 theme-icon-active" width="1em" height="1em">
            <use href="#circle-half"></use>
          </svg>
          <span class="visually-hidden" id="bd-theme-text">Toggle theme</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow">
          <li>
            <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light">
              <svg class="bi me-2 opacity-50" width="1em" height="1em">
                <use href="#sun-fill"></use>
              </svg>
              Light
              <svg class="bi ms-auto d-none" width="1em" height="1em">
                <use href="#check2"></use>
              </svg>
            </button>
          </li>
          <li>
            <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark">
              <svg class="bi me-2 opacity-50" width="1em" height="1em">
                <use href="#moon-stars-fill"></use>
              </svg>
              Dark
              <svg class="bi ms-auto d-none" width="1em" height="1em">
                <use href="#check2"></use>
              </svg>
            </button>
          </li>
          <li>
            <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto">
              <svg class="bi me-2 opacity-50" width="1em" height="1em">
                <use href="#circle-half"></use>
              </svg>
              Auto
              <svg class="bi ms-auto d-none" width="1em" height="1em">
                <use href="#check2"></use>
              </svg>
            </button>
          </li>
        </ul>
      </div>

      <div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="sidebar">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="sidebar-label">Backdrop with scrolling</h5>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
          <p>Try scrolling the rest of the page to see this option in action.</p>
          <hr />
          <ul class="list-group" id="nav-list">
            <a class="list-group-item list-group-item-action" href="product-list">Products</a>
            <a class="list-group-item list-group-item-action" href="product">Add Product</a>
            <a class="list-group-item list-group-item-action" href="category">Add Category</a>
          </ul>
        </div>
      </div>

      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark border-bottom" aria-label="sidebar">
        <div class="container-fluid">
          <a class="navbar-brand" href="#" data-bs-toggle="offcanvas" data-bs-target="#sidebar">Side bar</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav me-auto mb-2 mb-md-0">
              <li class="nav-item">
                <a class="nav-link active text-decoration-underline link-offset-2" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
              </li>
              <li class="nav-item">
                <a class="nav-link disabled">Disabled</a>
              </li>
              <hr class="dropdown-divider" />
            </ul>
            <form class="d-flex me-2" role="search">
              <div class="input-group">
                <input class="form-control" type="search" placeholder="Search..." />
                <button class="btn btn-outline-success" type="submit">Search</button>
              </div>
            </form>
            <a href="#" class="btn btn-outline-primary me-2">Sign in</a>
            <a href="#" class="btn btn-primary">Sign up</a>
          </div>
        </div>
      </nav>

      <!-- <div class="toast-container position-fixed top-0 start-50 translate-middle-x p-3">
        <div id="notification" class="toast show bg-danger text-bg-danger" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="7000">
          <div class="d-flex">
            <div class="toast-body">${param.response}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
          </div>
        </div>
      </div> -->
    </div>
    <main class="container-fluid pt-5 px-3">
      <div class="row g-3">
        <div class="col-12 col-md-4 col-xl-3">
          <aside class="container-fluid sticky-top" style="top: 4.5rem">
            <div class="border bg-body-tertiary rounded p-2 row">
              <div class="mb-3">
                <label class="form-label">Keywords</label>
                <br />
                <span class="badge text-bg-primary">Keyword</span>
                <span class="badge text-bg-primary">Keyword</span>
                <span class="badge text-bg-primary">Keyword</span>
              </div>
              <div class="mb-3">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="checkbox1" />
                  <label class="form-check-label" for="checkbox1"> Option 1 </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="checkbox2" />
                  <label class="form-check-label" for="checkbox2"> Option 2 </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="checkbox3" />
                  <label class="form-check-label" for="checkbox3"> Option 3 </label>
                </div>
              </div>
              <div class="mb-3">
                <label for="range1" class="form-label">Label ($0-100)</label>
                <strong class="float-end"> &gt; <output id="rangeOutput1">23</output>$</strong>
                <input type="range" class="form-range" min="0" max="100" value="23" id="min-sale-price" oninput="$('#rangeOutput1').val(this.value)" />
              </div>
              <div class="mb-3">
                <div class="mb-3">
                  <label for="category" class="form-label">Category</label>
                  <select class="form-select" name="dategory" id="dategory" disabled>
                    <option selected disabled>Select a category</option>
                    <option value="">New Delhi</option>
                    <option value="">Istanbul</option>
                    <option value="">Jakarta</option>
                  </select>
                </div>
              </div>
              <div class="mb-3">
                <label class="form-label">Product Details</label>
                <div class="form-check">
                  <input class="form-check-input toggle-display" type="checkbox" value="product-name" id="checkbox4" checked />
                  <label class="form-check-label" for="checkbox4"> Title </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input toggle-display" type="checkbox" value="product-category" id="checkbox5" checked />
                  <label class="form-check-label" for="checkbox5"> Categories </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input toggle-display" type="checkbox" value="product-unit-price" id="checkbox6" checked />
                  <label class="form-check-label" for="checkbox6"> Original Price </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input toggle-display" type="checkbox" value="product-sale-price" id="checkbox7" checked />
                  <label class="form-check-label" for="checkbox7"> Sale Price </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input toggle-display" type="checkbox" value="product-stock" id="checkbox8" checked />
                  <label class="form-check-label" for="checkbox8"> Quantity </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input toggle-display" type="checkbox" value="product-import-date" id="checkbox9" checked />
                  <label class="form-check-label" for="checkbox9"> Import Date </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input toggle-display" type="checkbox" value="product-description" id="checkbox10" checked />
                  <label class="form-check-label" for="checkbox10"> Description </label>
                </div>
              </div>
            </div>
          </aside>
        </div>
        <div class="col-12 col-md-8 col-xl-9">
          <div class="row row-cols-1 row-cols-xl-2 g-3 mb-3">
            <!-- <img src="asset/img/placeholder.jpg" class="img-fluid border rounded w-100" alt="..." /> -->
            <div cass="col">
              <div class="svg-image border rounded-3" id="placeholder" style="font-size: 10em">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                  <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0"></path>
                  <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z"></path>
                </svg>
              </div>
            </div>
            <div class="col">
              <div class="d-flex flex-column gap-3 bg-body-secondary rounded p-4 h-100 product-info">
                <h3 class="d-flex flex-wrap align-items-center gap-2">
                  <span class="me-3 product-name"> Product Title </span>
                  <span class="badge text-bg-primary rounded-pill product-category">Category</span>
                  <span class="badge text-bg-primary rounded-pill product-category">Category</span>
                  <span class="badge text-bg-primary rounded-pill product-category">Category</span>
                </h3>
                <h5 class="product-sale-price">
                  Pricing:
                  <span class="fw-normal gap-3">
                    <span class="text-success">$39.99</span>
                    <small class="text-secondary text-decoration-line-through product-unit-price"> $29.99 </small>
                  </span>
                </h5>
                <h5 class="product-stock">In stock: <span class="text-muted fw-normal"> 20 items </span></h5>
                <h5 class="product-import-date">
                  Import date:
                  <span class="text-muted fw-normal"> Sep 29, 2024 </span>
                </h5>
                <div class="product-description">
                  <h5>Description</h5>
                  <p class="px-3" style="text-align: justify; text-justify: inter-word">
                    Lorem ipsum dolor sit, amet consectetur adipisicing elit. Tenetur autem quaerat ab nostrum architecto, ratione voluptate quasi voluptatum, voluptatem explicabo ipsa consequuntur expedita rerum amet cumque, dolores iure
                    aperiam. Eaque, quasi! Commodi, quasi. Voluptates quas iure rerum animi, neque recusandae dicta eius porro explicabo impedit velit sed id facere provident.
                  </p>
                </div>
                <div class="ms-auto d-flex gap-2">
                  <button class="btn btn-primary rounded-pill">Buy Now</button>
                  <button class="btn btn-outline-primary rounded-pill">Add to Cart</button>
                </div>
              </div>
            </div>
          </div>
          <!-- <hr /> -->
          <script>
            $(document).ready(function () {
              $(".toggle-display").change(function () {
                let classToToggle = $(this).val();
                if ($(this).is(":checked")) {
                  $("." + classToToggle).show();
                } else {
                  $("." + classToToggle).hide();
                }
              });
            });
          </script>
          <div class="container-fluid p-3 rounded">
            <div class="container">
              <div class="d-flex gap-2 flex-wrap justify-content-between px-xl-5 mb-3">
                <div>
                  <h3>Reviews</h3>
                  <h4 class="d-flex">
                    <span class="me-2">4.3 out of 5.0</span>
                    <span class="ratings text-warning me-2" value="4.5" max="5"></span>
                  </h4>
                  <span class="text-secondary">7 ratings</span>
                </div>
                <!-- <button class="btn btn-outline-primary rounded-pill align-self-center" id="view-review-btn" data-bs-value="12">See my reviews</button> -->
                <button class="btn btn-outline-primary rounded-pill align-self-center" id="compose-review-btn" onclick="edit(this)">Write a review</button>
              </div>

              <div class="container px-xl-5">
                <div class="row g-3 mx-xl-5 mb-3">
                  <!-- User write review -->
                  <div class="card bg-body-tertiary" id="compose-review-container">
                    <div class="card-body">
                      <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
                        <symbol id="bi-plus-lg" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2" />
                        </symbol>
                        <symbol id="bi-x-lg" viewBox="0 0 16 16">
                          <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
                        </symbol>
                      </svg>
                      <form action="#">
                        <div class="d-flex mb-2 mb-md-0">
                          <img src="asset/img/default_picture.png" class="rounded-circle me-3" height="48" width="48" alt="" />
                          <div class="flex-auto flex-grow-1">
                            <h5 class="lh-1 d-flex align-items-center gap-2">
                              <span>Admin</span>
                              <span class="text-warning fs-6">
                                <input type="range" name="rating" min="1" max="5" id="user-rating" class="opacity-0 position-absolute" style="height: 1px; width: 96px" required />
                                <span class="d-flex position-absolute" style="top: 18px">
                                  <div class="d-inline-block">
                                    <i class="ratings" value="0" max="5"></i>
                                    <div class="d-flex gap-1 align-items-center overflow-hidden position-absolute top-0" id="star-select-container">
                                      <i class="bi bi-star-fill star-select" data-bs-value="1"></i>
                                      <i class="bi bi-star-fill star-select" data-bs-value="2"></i>
                                      <i class="bi bi-star-fill star-select" data-bs-value="3"></i>
                                      <i class="bi bi-star-fill star-select" data-bs-value="4"></i>
                                      <i class="bi bi-star-fill star-select" data-bs-value="5"></i>
                                    </div>
                                  </div>
                                </span>
                              </span>
                            </h5>
                            <button class="btn btn-sm btn-outline-primary mb-2" type="button" id="add-attachment-btn">
                              <svg class="bi me-1" width="1em" height="1em"><use href="#bi-plus-lg"></use></svg>
                              <span>Add attachment</span>
                              <span class="form-text">&lt; 10MB</span>
                            </button>
                            <div id="user-attachments"></div>
                            <textarea class="form-control" rows="4" name="user-review" id="user-review"></textarea>
                          </div>
                        </div>
                        <script>
                          $(() => {
                            const $composeReviewContainer = $("#compose-review-container");
                            const $userAttachments = $("#user-attachments");
                            const $addAttachmentBtn = $("#add-attachment-btn");
                            const $composeReviewBtn = $("#compose-review-btn");
                            const $userReview = $("#user-review");
                            const $userRating = $("#user-rating");
                            const $starSelectContainer = $("#star-select-container");
                            const maxFiles = 4;
                            const maxFileSizeInMB = 50;
                            const maxFileSizeInByte = maxFileSizeInMB * 1024 * 1024;
                            const starSelectBorderClass = "border border-warning";

                            function updateUserRating(rating = 0) {
                              $(".star-select").css("opacity", function () {
                                return $(this).data("bs-value") <= rating ? 1 : 0;
                              });
                            }

                            function edit(btn) {
                              $composeReviewBtn.prop("disabled", true);
                              $composeReviewContainer.show();
                              $userReview.focus();
                              $addAttachmentBtn.show();
                            }

                            function discard(btn) {
                              $composeReviewBtn.prop("disabled", false);
                              $composeReviewContainer.hide();
                              $userAttachments.empty();
                              updateUserRating();
                            }

                            $composeReviewBtn.click(edit);
                            $("#cancel-review-btn").click(discard);

                            $userAttachments
                              .on("click", ".remove-attachment", function () {
                                $(this).closest(".attachment").remove();
                                $addAttachmentBtn.show();
                              })
                              .on("change", ".attachment-input", function (e) {
                                const file = e.target.files[0];
                                if (file.size > maxFileSizeInByte) {
                                  alert(`"${file.name}" exceeds the size limit of ${maxFileSizeInMB}MB.`);
                                  $(this).val(null);
                                }
                              });

                            $addAttachmentBtn.click(function () {
                              $userAttachments.append(`<div class="input-group input-group-sm mb-2 attachment">
                                <button class="btn btn-danger remove-attachment" type="button"><svg class="bi" width="1em" height="1em"><use href="#bi-x-lg"></use></svg></button>
                                <input type="file" name="attachment[]" accept="video/*,image/*" class="form-control attachment-input" />
                                <input type="text" name="attachment-description[]" class="form-control w-50" placeholder="Description... (optional)" />
                              </div>`);

                              if ($userAttachments.children(".attachment").length >= maxFiles) {
                                $(this).hide();
                              }
                            });

                            $(".star-select").click(function () {
                              const value = $(this).data("bs-value");
                              $userRating.val(value).trigger("input");
                            });

                            $userRating
                              .on("focus blur", function (e) {
                                $starSelectContainer.toggleClass(starSelectBorderClass, e.type === "focus");
                              })
                              .on("input", function () {
                                updateUserRating($(this).val());
                              });

                            // initial
                            updateUserRating();
                            $composeReviewContainer.hide();
                          });
                        </script>
                        <div class="float-end d-flex gap-2 mt-md-2" id="review-control">
                          <button type="reset" id="cancel-review-btn" class="btn btn-sm btn-outline-secondary rounded-pill px-4 border-0">Discard</button>
                          <button type="submit" id="submit-review-btn" class="btn btn-sm btn-primary rounded-pill px-4">Post</button>
                        </div>
                      </form>
                    </div>
                  </div>
                  <!-- User write review -->
                </div>
                <div class="row g-3 mx-xl-5 mb-3" id="new-review-container">
                  <div class="card bg-body-tertiary" id="review-${review.reviewId}">
                    <div class="card-body d-flex justify-content-between">
                      <div class="d-flex mb-2 mb-md-0">
                        <img src="asset/img/default_picture.png" class="rounded-circle me-3" height="48" width="48" alt="" />
                        <div class="flex-auto">
                          <div class="lh-1 mb-0 d-inline-flex flex-wrap align-items-center gap-2">
                            <span class="fw-semibold">@User</span>
                            <i class="ratings text-warning fs-6" value="4" max="5"></i>
                            <small class="fw-light text-muted">Nov 3, 2024</small>
                          </div>
                          <p class="mb-0">Test comment</p>
                          <!-- ${$attachmentHtml.prop("outerHTML")} -->
                          <div class="mt-2">
                            <a href="asset/img/default_picture.png" class="btn btn-sm me-1 mb-1 attachment btn-outline-primary rounded-pill px-3"><i class="bi bi-image"></i></a>
                          </div>
                        </div>
                      </div>
                      <button type="button" class="btn rounded-circle align-self-start">
                        <i class="bi bi-three-dots-vertical"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <button class="btn btn-outline-primary border-0 rounded-pill mx-xl-5" data-bs-toggle="modal" data-bs-target="#reviewsModal">See all reviews</button>
              </div>
            </div>
          </div>
        </div>
        <!-- user review -->
        <!-- user review -->
      </div>
    </main>

    <div class="container">
      <footer class="py-3 my-4">
        <ul class="nav justify-content-center border-bottom pb-3 mb-3">
          <li class="nav-item">
            <a href="#" class="nav-link px-2 text-body-secondary">Home</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link px-2 text-body-secondary">Features</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link px-2 text-body-secondary">Pricing</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link px-2 text-body-secondary">FAQs</a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link px-2 text-body-secondary">About</a>
          </li>
        </ul>
        <p class="text-center text-body-secondary">&copy; 2024 Company, Inc</p>
      </footer>
    </div>

    <div class="modal fade" id="reviewsModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-md-down modal-xl">
        <div class="modal-content" style="min-height: 80dvh">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="reviewsModalLabel">User reviews</h1>
            <span class="fw-semibold fs-5 ms-4" id="modal-product-rating">0.0 out of 5.0</span>
            <span class="fs-5 ratings text-warning ms-2" value="0.0" max="5" id="modal-star-rating"></span>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="container-fluid px-5">
              <div class="row g-3 mx-xl-5 mb-3" id="user-reviews-container"></div>
              <div class="d-flex">
                <button class="btn btn-outline-primary rounded-pill px-4 mx-auto" id="load-more-btn">Load more</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        $("body").tooltip({
          selector: ".attachment",
        });

        const attachmentType = {
          image: ["btn-outline-primary", "bi bi-image"],
          video: ["btn-outline-danger", "bi bi-camera-video"],
          default: ["btn-outline-secondary", "bi bi-paperclip"],
        };

        const spinnerHtml = '<div class="spinner-border mx-auto" role="status"><span class="visually-hidden">Loading...</span></div>';
        const $reviewContainer = $("#user-reviews-container");
        const $loadMoreBtn = $("#load-more-btn");
        const productId = 25;
        let offset = 0;

        function appendReview(response, container = $reviewContainer) {
          if (!response.reviewList.length) {
            container.html(`<h5 class="text-center">">No review yet</h5>`);
            $loadMoreBtn.hide();
            return;
          }

          response.reviewList.forEach((review) => {
            // let attachmentHtml = (response.attachmentMap[review.reviewId] || [])
            //   .map((a) => {
            //     return `<a href="${a.attachment}" class="btn btn-sm me-1 mb-1 attachment ${attachmentType[a.type][0]} rounded-pill px-3"}><i class="${attachmentType[a.type][1]}"></i></a>`;
            //   })
            //   .join("");
            // if (attachmentHtml.length) attachmentHtml = `<div class="mt-2">${attachmentHtml}</div>`;
            let $attachmentHtml = $('<div class="mt-2"></div>');
            (response.attachmentMap[review.reviewId] || []).forEach((a) => {
              let $attachmentLink = $(`<a href="${a.attachment}" class="btn btn-sm me-1 mb-1 attachment ${attachmentType[a.type][0]} rounded-pill px-3"><i class="${attachmentType[a.type][1]}"></i></a>`);
              if (a.description) {
                $attachmentLink.attr({
                  "data-bs-toggle": "tooltip",
                  "data-bs-title": a.description,
                });
              }
              $attachmentHtml.append($attachmentLink);
            });

            let reviewItem = `
              <div class="card bg-body-tertiary" id="review-${review.reviewId}">
                <div class="card-body d-flex justify-content-between">
                  <div class="d-flex mb-2 mb-md-0">
                    <img src="${review.userAvatar || "asset/img/default_picture.png"}" class="rounded-circle me-3" height="48" width="48"/>
                    <div class="flex-auto">
                      <div class="lh-1 mb-0 d-inline-flex flex-wrap align-items-center gap-2">
                        <span class="fw-semibold">@${review.userName}</span>
                        <i class="ratings text-warning fs-6" value="${review.rating}" max="5"></i>
                        <small class="fw-light text-muted">${review.createdAt}</small>
                      </div>
                      <p class="mb-0">${review.comment}</p>
                      ${$attachmentHtml.prop("outerHTML")}
                    </div>
                  </div>
                  <button type="button" class="btn rounded-circle align-self-start">
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>
                </div>
              </div>`;

            // reviewHtml.push(reviewItem);
            container.append(reviewItem);
          });

          $(".ratings").each(updateRating);
          offset += response.reviewList.length;

          if (response.haveMoreReviews) {
            $loadMoreBtn.show();
          } else {
            $loadMoreBtn.hide();
          }
        }

        function loadReviews({ productId = 25, limit = 10, offset = 0, container = $("#user-reviews-container") }) {
          const timeOut = 1500;
          $loadMoreBtn.hide();
          container.append(spinnerHtml);
          $.ajax({
            url: "http://localhost:8080/shop/review",
            type: "get",
            data: {
              productId: productId,
              limit: limit,
              offset: offset,
            },
            timeout: 5000,
            success: (result) => {
              $("#modal-product-rating").text(`${result.productRating.toFixed(1)} out of 5.0`);
              $("#modal-star-rating").attr("value", result.productRating);
              $(".ratings").each(updateRating);

              setTimeout(() => {
                appendReview(result, container);
                container.children(".spinner-border").remove();
              }, timeOut);
            },
            error: (xhr, status, error) => {
              console.error("Error:", error);
              setTimeout(() => {
                container.html(`<h5 class="text-center text-danger">Failed to retrieve user reviews</h5>`);
                $loadMoreBtn.show();
              }, timeOut);
            },
          });
        }

        $loadMoreBtn.click(() => {
          loadReviews({ productId: productId, offset: offset });
        });

        $("#reviewsModal")
          .on("show.bs.modal", (e) => {
            offset = 0;
            loadReviews({ productId: productId });
          })
          .on("hide.bs.modal", (e) => {
            $reviewContainer.html(null);
          });

        // loadReviews(productId, 3, 0, $("#new-review-container"));
        loadReviews({ productId: productId, limit: 3, container: $("#new-review-container") });

        /// /// /// /// /// /// /// /// /// ///

        function updateRating() {
          let rating = parseFloat($(this).attr("value"));
          let maxRating = parseFloat($(this).attr("max")) || 5;
          let fullStars = Math.floor(rating);
          let halfStar = rating % 1 >= 0.5 ? 1 : 0;
          let emptyStars = maxRating - fullStars - halfStar;
          let starsHtml = '<i class="bi bi-star-fill"></i>'.repeat(fullStars) + (halfStar ? '<i class="bi bi-star-half"></i>' : "") + '<i class="bi bi-star"></i>'.repeat(emptyStars);
          $(this).html(starsHtml);
        }
      });
    </script>
    <script src="js/bootstrap.bundle.min.js"></script>
  </body>
</html>
